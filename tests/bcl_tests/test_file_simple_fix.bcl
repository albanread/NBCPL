// test_file_simple_fix.bcl
// Simple test to verify FILE_ API functionality after fixing the runtime bridge

LET START() = VALOF {
    LET filename = "test_output.txt"
    LET handle = 0
    LET result = 0

    WRITEF("Testing FILE_ API...*N")

    // Test 1: Open file for writing
    WRITEF("1. Opening file for writing...*N")
    handle := FILE_OPEN_WRITE(filename)
    TEST handle = 0 THEN {
        WRITEF("ERROR: Failed to open file for writing*N")
        RESULTIS 1
    } ELSE {
        WRITEF("SUCCESS: File opened for writing (handle: %d)*N", handle)
    }

    // Test 2: Write string to file
    WRITEF("2. Writing string to file...*N")
    result := FILE_WRITES(handle, "Hello, FILE_ API!")
    TEST result = 0 THEN {
        WRITEF("ERROR: Failed to write string to file*N")
        FILE_CLOSE(handle)
        RESULTIS 2
    } ELSE {
        WRITEF("SUCCESS: Wrote %d bytes to file*N", result)
    }

    // Test 3: Close file
    WRITEF("3. Closing file...*N")
    result := FILE_CLOSE(handle)
    TEST result = 0 THEN {
        WRITEF("SUCCESS: File closed successfully*N")
    } ELSE {
        WRITEF("ERROR: Failed to close file (error: %d)*N", result)
        RESULTIS 3
    }

    // Test 4: Open file for reading
    WRITEF("4. Opening file for reading...*N")
    handle := FILE_OPEN_READ(filename)
    TEST handle = 0 THEN {
        WRITEF("ERROR: Failed to open file for reading*N")
        RESULTIS 4
    } ELSE {
        WRITEF("SUCCESS: File opened for reading (handle: %d)*N", handle)
    }

    // Test 5: Read string from file
    WRITEF("5. Reading string from file...*N")
    LET content = FILE_READS(handle)
    TEST content = 0 THEN {
        WRITEF("ERROR: Failed to read string from file*N")
        FILE_CLOSE(handle)
        RESULTIS 5
    } ELSE {
        WRITEF("SUCCESS: Read content: '%s'*N", content)
    }

    // Test 6: Close file again
    WRITEF("6. Closing file...*N")
    result := FILE_CLOSE(handle)
    TEST result = 0 THEN {
        WRITEF("SUCCESS: File closed successfully*N")
    } ELSE {
        WRITEF("ERROR: Failed to close file (error: %d)*N", result)
        RESULTIS 6
    }

    WRITEF("*Nâœ… All FILE_ API tests passed!*N")
    RESULTIS 0
}
